# CIDR（无类域间路由）详解

## 1. 基本概念
- CIDR是一种对IP地址进行划分的方法，取代了早期的分类地址（A、B、C类）
- 使用"前缀长度"来灵活指定网络部分的长度，而不是固定的地址类别
- 格式：`IPv6地址/前缀长度`
- 前缀长度：表示网络部分的位数（0-128）
- 示例：`2001:db8::/32` 表示前32位是网络前缀

## 2. CIDR与子网掩码
1. **基本关系**：
   - CIDR前缀长度（/n）等价于设置了n个1的子网掩码
   - 子网掩码是CIDR的二进制表示方式

2. **IPv4中的对应关系**（作为参考）：
   - /24 = 255.255.255.0
   - /16 = 255.255.0.0
   - /8 = 255.0.0.0

3. **IPv6的区别**：
   - IPv6通常只使用CIDR表示法（/n）
   - 不再使用点分十进制的子网掩码表示
   - 子网边界通常在4位十六进制数（16位）的边界上
   - 常用前缀：/32、/48、/56、/64

4. **为什么IPv6倾向使用CIDR**：
   - 更简洁的表示方式
   - 128位地址用子网掩码表示过于冗长
   - 便于理解和计算网络/主机部分
   - 符合现代网络设计理念

## 3. 前缀长度详解
1. `/32`：
   - 用途：运营商（ISP）分配的基本块
   - 容量：可以划分65,536个/48网络
   - 结构：
     * 前32位：运营商前缀
     * 中间16位：分配给组织的网络ID
     * 后80位：组织内部使用

2. `/48`：
   - 用途：组织或企业网络的标准分配
   - 容量：可以划分65,536个/64子网
   - 结构：
     * 前48位：全局路由前缀
     * 中间16位：子网ID
     * 后64位：接口ID

3. `/56`：
   - 用途：小型组织或家庭网络
   - 容量：可以划分256个/64子网
   - 结构：
     * 前56位：全局路由前缀
     * 中间8位：子网ID
     * 后64位：接口ID

4. `/64`：
   - 用途：基本子网（最小推荐子网大小）
   - 特点：为接口标识符预留64位
   - 结构：
     * 前64位：网络前缀（包含子网）
     * 后64位：接口ID（可用于SLAAC）

5. `/128`：
   - 用途：单个接口地址
   - 特点：完整的IPv6地址，无子网空间
   - 结构：所有128位都被指定

## 4. 子网划分详解
### 4.1 基本原理
1. **前缀位数增加原理**：
   - 每增加1位前缀，可用子网数量翻倍
   - 每增加n位前缀，可用子网数量增加2^n倍

2. **常见的子网划分**：
   - `/48` → `/64`：可以划分65,536个子网
   - `/56` → `/64`：可以划分256个子网

3. **子网编号**：
   - 从0开始编号
   - 按照二进制顺序递增
   - 例如从/56划分/64：
     * 子网1：`2001:0db8:0000:0000::/64`
     * 子网2：`2001:0db8:0000:0001::/64`
     * ...
     * 子网256：`2001:0db8:0000:00ff::/64`

### 4.2 从/48到/64的划分过程
1. **起始状态** (/48)：
   ```
   2001:0db8:0123::/48
   ```

2. **可用子网范围**：
   ```
   第一个子网：2001:0db8:0123:0000::/64
   第二个子网：2001:0db8:0123:0001::/64
   ...
   最后子网：2001:0db8:0123:ffff::/64
   ```

### 4.3 从/56到/64的划分过程
1. **起始状态** (/56)：
   ```
   2001:0db8:0123:ab00::/56
   ```

2. **可用子网范围**：
   ```
   第一个子网：2001:0db8:0123:ab00::/64
   第二个子网：2001:0db8:0123:ab01::/64
   ...
   最后子网：2001:0db8:0123:abff::/64
   ```

### 4.4 实际划分示例
假设企业获得前缀 `2001:db8:1234::/48`：

1. **总部和分部规划** (/56)：
   ```
   总部：2001:db8:1234:0000::/56
   分部1：2001:db8:1234:0100::/56
   分部2：2001:db8:1234:0200::/56
   ...
   ```

2. **部门子网划分** (/64)：
   ```
   工程部：2001:db8:1234:0001::/64
   市场部：2001:db8:1234:0002::/64
   财务部：2001:db8:1234:0003::/64
   ...
   ```

### 4.5 子网划分注意事项
1. **规划建议**：
   - 保持子网编号有规律，便于管理
   - 预留足够的扩展空间
   - 考虑未来增长需求
   - 使用易于理解的编号方案

2. **安全考虑**：
   - 避免使用连续的子网号
   - 为不同安全级别的网络使用不同的子网段
   - 考虑网络隔离需求

3. **性能优化**：
   - 合理规划路由聚合
   - 避免过度细分子网
   - 保持路由表简洁
