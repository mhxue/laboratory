# IPv6 基础知识

## 1. IPv6地址格式

### 1.1 基本格式
- 128位长度，分为8组，每组16位（4个十六进制数字）
- 每组之间用冒号（:）分隔
- 示例：`2001:0db8:85a3:0000:0000:8a2e:0370:7334`

### 1.2 地址简写规则
1. 省略前导零：
   - `2001:0db8` → `2001:db8`
2. 压缩连续的零组（使用`::`）：
   - `2001:0db8:0000:0000:0000:8a2e:0370:7334`
   - → `2001:db8::8a2e:370:7334`
3. `::`只能使用一次

## 2. IPv6地址类型

### 2.1 单播地址（Unicast）
1. 全局单播地址（Global Unicast）
   - 前缀：2000::/3
   - 可在互联网上全球路由
   - 类似于IPv4的公网地址

2. 链路本地地址（Link-Local）
   - 前缀：fe80::/10
   - 仅在本地链路有效
   - 不可路由
   - 用于邻居发现和自动配置

3. 唯一本地地址（Unique Local）
   - 前缀：fc00::/7
   - 类似于IPv4的私有地址
   - 仅在组织内部使用

### 2.2 多播地址（Multicast）
- 前缀：ff00::/8
- 一对多通信
- 常见范围：
  * ff02::1（所有节点）
  * ff02::2（所有路由器）
  * ff02::1:ff00:0/104（请求节点）

### 2.3 任播地址（Anycast）
- 分配给多个接口
- 数据包发送到"最近的"接口
- 用于负载均衡和冗余

## 3. 特殊地址

1. 未指定地址
   - `::/128`
   - 类似于IPv4的0.0.0.0

2. 回环地址
   - `::1/128`
   - 类似于IPv4的127.0.0.1

3. IPv4映射地址
   - `::ffff:0:0/96`
   - 用于IPv4-IPv6转换

## 4. 子网划分

### 4.1 CIDR表示法
- 格式：IPv6地址/前缀长度
- 示例：2001:db8::/32

### 4.2 常见前缀长度
- /48：组织
- /56：站点
- /64：子网（最常用）
- /128：单个接口

## 5. IPv6报文头部

### 5.1 基本头部字段
1. 版本（4位）
2. 通信类别（8位）
3. 流标签（20位）
4. 载荷长度（16位）
5. 下一个头部（8位）
6. 跳数限制（8位）
7. 源地址（128位）
8. 目标地址（128位）

### 5.2 扩展头部
1. 逐跳选项头部
2. 目的地选项头部
3. 路由头部
4. 分片头部
5. 认证头部
6. 封装安全载荷头部

## 6. IPv6与IPv4的主要区别

### 6.1 地址空间
- IPv4：32位（约43亿个地址）
- IPv6：128位（约3.4×10^38个地址）

### 6.2 头部格式
- IPv6简化了头部格式
- 移除了校验和字段
- 使用扩展头部处理可选功能

### 6.3 安全性
- IPv6内置IPSec支持
- 更好的隐私保护机制

### 6.4 自动配置
- 支持无状态地址自动配置（SLAAC）
- 改进的邻居发现协议（NDP）

### 6.5 服务质量
- 流标签支持
- 更好的QoS支持

## 7. 基本配置命令

### 7.1 Linux系统
```bash
# 查看IPv6地址
ip -6 addr show

# 添加IPv6地址
ip -6 addr add 2001:db8::1/64 dev eth0

# 删除IPv6地址
ip -6 addr del 2001:db8::1/64 dev eth0

# 查看IPv6路由
ip -6 route show
```

### 7.2 Windows系统
```cmd
# 查看IPv6配置
ipconfig /all

# 测试IPv6连通性
ping -6 2001:db8::1

# 跟踪IPv6路由
tracert -6 2001:db8::1
```

## 8. 常见问题排查

### 8.1 连通性测试
```bash
# ping测试
ping6 2001:db8::1

# 路径跟踪
traceroute6 2001:db8::1

# 邻居缓存查看
ip -6 neigh show
```

### 8.2 常见问题
1. 链路本地地址问题
2. 路由器通告配置
3. DNS解析问题
4. 安全策略限制

## 9. 最佳实践

1. 地址规划
   - 使用有意义的地址分配方案
   - 保留足够的地址空间供将来使用

2. 安全考虑
   - 启用防火墙规则
   - 使用IPSec
   - 实施访问控制

3. 监控和维护
   - 定期检查连通性
   - 监控地址使用情况
   - 更新安全策略

4. 文档管理
   - 记录地址分配
   - 维护配置变更日志
   - 建立问题处理流程
